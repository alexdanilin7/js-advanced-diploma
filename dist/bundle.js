/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={186:(e,t,r)=>{e.exports=r.p+"images/2429af6d3a5796e3c34b.png"},227:(e,t,r)=>{e.exports=r.p+"images/f5c75398bcb5931f9f3c.png"},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},756:(e,t,r)=>{e.exports=r.p+"images/bf0ed0dca1d1e6091d42.png"},1016:(e,t,r)=>{r.d(t,{A:()=>qe});var n=r(1601),o=r.n(n),a=r(6314),i=r.n(a),c=r(4417),l=r.n(c),s=new URL(r(7935),r.b),u=new URL(r(1409),r.b),f=new URL(r(3232),r.b),p=new URL(r(1265),r.b),h=new URL(r(6267),r.b),d=new URL(r(186),r.b),y=new URL(r(9745),r.b),b=new URL(r(8490),r.b),m=new URL(r(2573),r.b),v=new URL(r(4496),r.b),g=new URL(r(8956),r.b),w=new URL(r(9221),r.b),S=new URL(r(6092),r.b),P=new URL(r(4184),r.b),k=new URL(r(5513),r.b),O=new URL(r(3062),r.b),C=new URL(r(4875),r.b),j=new URL(r(5134),r.b),x=new URL(r(7335),r.b),L=new URL(r(6153),r.b),E=new URL(r(9e3),r.b),T=new URL(r(9593),r.b),R=new URL(r(5523),r.b),_=new URL(r(7986),r.b),U=new URL(r(4041),r.b),M=new URL(r(7538),r.b),G=new URL(r(1605),r.b),$=new URL(r(6318),r.b),A=new URL(r(3933),r.b),z=new URL(r(6291),r.b),N=new URL(r(9702),r.b),B=new URL(r(1906),r.b),I=new URL(r(4347),r.b),D=new URL(r(1216),r.b),F=new URL(r(4437),r.b),q=new URL(r(3160),r.b),H=new URL(r(8341),r.b),J=new URL(r(2076),r.b),Q=new URL(r(3860),r.b),W=new URL(r(6943),r.b),K=new URL(r(6168),r.b),V=new URL(r(227),r.b),X=new URL(r(756),r.b),Y=new URL(r(9334),r.b),Z=i()(o()),ee=l()(s),te=l()(u),re=l()(f),ne=l()(p),oe=l()(h),ae=l()(d),ie=l()(y),ce=l()(b),le=l()(m),se=l()(v),ue=l()(g),fe=l()(w),pe=l()(S),he=l()(P),de=l()(k),ye=l()(O),be=l()(C),me=l()(j),ve=l()(x),ge=l()(L),we=l()(E),Se=l()(T),Pe=l()(R),ke=l()(_),Oe=l()(U),Ce=l()(M),je=l()(G),xe=l()($),Le=l()(A),Ee=l()(z),Te=l()(N),Re=l()(B),_e=l()(I),Ue=l()(D),Me=l()(F),Ge=l()(q),$e=l()(H),Ae=l()(J),ze=l()(Q),Ne=l()(W),Be=l()(K),Ie=l()(V),De=l()(X),Fe=l()(Y);Z.push([e.id,`:root {\n  --cell-size: 64px;\n}\n\nhtml, body {\n  height: 100%;\n  margin: 0;\n}\n\nbody {\n  background: #000;\n  font-size: 16px;\n}\n\n.btn {\n  display: inline-block;\n  font-weight: 400;\n  color: #212529;\n  background-color: #f8f9fa;\n  text-align: center;\n  vertical-align: middle;\n  padding: .375rem .75rem;\n  font-size: 1rem;\n  line-height: 1.5;\n  border-radius: .25rem;\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\n  border: none;\n}\n\n.controls {\n  text-align: center;\n  margin: 50px 0;\n}\n\n.board-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n\n.board {\n  display: grid;\n  grid-template-columns: repeat(8, 1fr);\n  grid-column-gap: 2px;\n  grid-row-gap: 2px;\n}\n\n.cell {\n  position: relative;\n}\n\n.cell.selected::before {\n  content: '';\n  display: block;\n  border: 4px;\n  border-radius: 32px;\n  box-sizing: border-box;\n  width: var(--cell-size);\n  height: var(--cell-size);\n  opacity: 0.9;\n  position: absolute;\n}\n\n.cell.selected-yellow::before {\n  border-color: #ff0;\n  border-style: solid;\n}\n\n.cell.selected-green::before {\n  border-color: #0f0;\n  border-style: dashed;\n}\n\n.cell.selected-red::before {\n  border-color: #f00;\n  border-style: dashed;\n}\n\n.board.prairie {\n  --map-tile-top-left-url: url(${ee});\n  --map-tile-top-url: url(${te});\n  --map-tile-top-right-url: url(${re});\n  --map-tile-bottom-left-url: url(${ne});\n  --map-tile-bottom-url: url(${oe});\n  --map-tile-bottom-right-url: url(${ae});\n  --map-tile-left-url: url(${ie});\n  --map-tile-right-url: url(${ce});\n  --map-tile-center-url: url(${le});\n}\n\n.board.desert {\n  --map-tile-top-left-url: url(${se});\n  --map-tile-top-url: url(${ue});\n  --map-tile-top-right-url: url(${fe});\n  --map-tile-bottom-left-url: url(${pe});\n  --map-tile-bottom-url: url(${he});\n  --map-tile-bottom-right-url: url(${de});\n  --map-tile-left-url: url(${ye});\n  --map-tile-right-url: url(${be});\n  --map-tile-center-url: url(${me});\n}\n\n.board.arctic {\n  --map-tile-top-left-url: url(${ve});\n  --map-tile-top-url: url(${ge});\n  --map-tile-top-right-url: url(${we});\n  --map-tile-bottom-left-url: url(${Se});\n  --map-tile-bottom-url: url(${Pe});\n  --map-tile-bottom-right-url: url(${ke});\n  --map-tile-left-url: url(${Oe});\n  --map-tile-right-url: url(${Ce});\n  --map-tile-center-url: url(${je});\n}\n\n.board.mountain {\n  --map-tile-top-left-url: url(${xe});\n  --map-tile-top-url: url(${Le});\n  --map-tile-top-right-url: url(${Ee});\n  --map-tile-bottom-left-url: url(${Te});\n  --map-tile-bottom-url: url(${Re});\n  --map-tile-bottom-right-url: url(${_e});\n  --map-tile-left-url: url(${Ue});\n  --map-tile-right-url: url(${Me});\n  --map-tile-center-url: url(${Ge});\n}\n\n.map-tile {\n  width: var(--cell-size);\n  height: var(--cell-size);\n}\n\n.map-tile-top-left {\n  background: var(--map-tile-top-left-url);\n}\n\n.map-tile-top {\n  background: var(--map-tile-top-url);\n}\n\n.map-tile-top-right {\n  background: var(--map-tile-top-right-url);\n}\n\n.map-tile-bottom-left {\n  background: var(--map-tile-bottom-left-url);\n}\n\n.map-tile-bottom {\n  background: var(--map-tile-bottom-url);\n}\n\n.map-tile-bottom-right {\n  background: var(--map-tile-bottom-right-url);\n}\n\n.map-tile-left {\n  background: var(--map-tile-left-url);\n}\n\n.map-tile-right {\n  background: var(--map-tile-right-url);\n}\n\n.map-tile-center {\n  background: var(--map-tile-center-url);\n}\n\n.character {\n  width: var(--cell-size);\n  height: var(--cell-size);\n  position: absolute;\n  z-index: 99;\n}\n\n.character.generic {\n  background: url(${$e});\n}\n\n.character.bowman {\n  background: url(${Ae});\n}\n\n.character.daemon {\n  background: url(${ze});\n}\n\n.character.magician {\n  background: url(${Ne});\n}\n\n.character.swordsman {\n  background: url(${Be});\n}\n\n.character.undead {\n  background: url(${Ie});\n}\n\n.character.vampire {\n  background: url(${De});\n}\n\n.character.zombie {\n  background: url(${Fe});\n}\n\n.health-level {\n  top: 2px;\n  left: 7px;\n  position: absolute;\n  width: 50px;\n  height: 4px;\n  background: #000;\n}\n\n.health-level-indicator {\n  height: 4px;\n}\n\n.health-level-indicator-high {\n  background: #0f0;\n}\n\n.health-level-indicator-normal {\n  background: #ff0;\n}\n\n.health-level-indicator-critical {\n  background: #f00;\n}\n\n.damage {\n  position: absolute;\n  width: var(--cell-size);\n  text-align: center;\n  z-index: 999;\n  color: #f00;\n  font-weight: bold;\n  animation: 500ms fade ease-out;\n}\n\n@keyframes fade {\n  from {\n    opacity: 0;\n    top: calc(var(--cell-size) * 0.5);\n    font-size: 1rem;\n  }\n  to {\n    opacity: 1;\n    top: -20px;\n    font-size: 1.5rem;\n  }\n}\n`,""]);const qe=Z},1113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},1216:(e,t,r)=>{e.exports=r.p+"images/c75f062dddba6e98fdc6.png"},1265:(e,t,r)=>{e.exports=r.p+"images/26b5f224d8750119922d.png"},1409:(e,t,r)=>{e.exports=r.p+"images/946aeb948db6313f1d85.png"},1601:e=>{e.exports=function(e){return e[1]}},1605:(e,t,r)=>{e.exports=r.p+"images/246277b8ca590816b3e8.png"},1906:(e,t,r)=>{e.exports=r.p+"images/f462d2ed6eedca1e4fd9.png"},2076:(e,t,r)=>{e.exports=r.p+"images/cec542854b228e61547a.png"},2573:(e,t,r)=>{e.exports=r.p+"images/0089a610e6611f679b50.png"},3062:(e,t,r)=>{e.exports=r.p+"images/eb1f6e4f87b977012684.png"},3160:(e,t,r)=>{e.exports=r.p+"images/6f6f7c09bde970b2e41b.png"},3232:(e,t,r)=>{e.exports=r.p+"images/0ac7f8258ec7166dc957.png"},3860:(e,t,r)=>{e.exports=r.p+"images/cf170a9fea1051b7424a.png"},3933:(e,t,r)=>{e.exports=r.p+"images/8b928c3eb136543e573a.png"},4041:(e,t,r)=>{e.exports=r.p+"images/3d9503e0a850fda86f82.png"},4184:(e,t,r)=>{e.exports=r.p+"images/f1703771380a9959d979.png"},4347:(e,t,r)=>{e.exports=r.p+"images/6bacb8e25ed9ecf726bf.png"},4417:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},4437:(e,t,r)=>{e.exports=r.p+"images/26fdc25019c24e87f11a.png"},4496:(e,t,r)=>{e.exports=r.p+"images/258d884122fabfc2f312.png"},4875:(e,t,r)=>{e.exports=r.p+"images/2c19971f327b288278bb.png"},5056:(e,t,r)=>{e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},5072:e=>{var t=[];function r(e){for(var r=-1,n=0;n<t.length;n++)if(t[n].identifier===e){r=n;break}return r}function n(e,n){for(var a={},i=[],c=0;c<e.length;c++){var l=e[c],s=n.base?l[0]+n.base:l[0],u=a[s]||0,f="".concat(s," ").concat(u);a[s]=u+1;var p=r(f),h={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(h);else{var d=o(h,n);n.byIndex=c,t.splice(c,0,{identifier:f,updater:d,references:1})}i.push(f)}return i}function o(e,t){var r=t.domAPI(t);return r.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,o){var a=n(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<a.length;i++){var c=r(a[i]);t[c].references--}for(var l=n(e,o),s=0;s<a.length;s++){var u=r(a[s]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}a=l}}},5134:(e,t,r)=>{e.exports=r.p+"images/51e2a5de56bd631452fe.png"},5513:(e,t,r)=>{e.exports=r.p+"images/5cf9c17d6a1ea7106a6c.png"},5523:(e,t,r)=>{e.exports=r.p+"images/63aae58e4690953a3857.png"},6092:(e,t,r)=>{e.exports=r.p+"images/13edb269e39172ddd74f.png"},6153:(e,t,r)=>{e.exports=r.p+"images/e0aa3daf6d08c62c96d9.png"},6168:(e,t,r)=>{e.exports=r.p+"images/2007ec00c1d9f997e704.png"},6267:(e,t,r)=>{e.exports=r.p+"images/07d5e8127645225478b6.png"},6291:(e,t,r)=>{e.exports=r.p+"images/a1d2321024649b9d8f5f.png"},6314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var r="",n=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),n&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),n&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r}).join("")},t.i=function(e,r,n,o,a){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(n)for(var c=0;c<this.length;c++){var l=this[c][0];null!=l&&(i[l]=!0)}for(var s=0;s<e.length;s++){var u=[].concat(e[s]);n&&i[u[0]]||(void 0!==a&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=a),r&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=r):u[2]=r),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),t.push(u))}},t}},6318:(e,t,r)=>{e.exports=r.p+"images/ef1b0ea8c4e545d9aadc.png"},6943:(e,t,r)=>{e.exports=r.p+"images/c0fa2b75539f94144dc4.png"},7335:(e,t,r)=>{e.exports=r.p+"images/eab6a2cc5e89a4dd8e3f.png"},7538:(e,t,r)=>{e.exports=r.p+"images/22e7c5ede3f747cbe27a.png"},7659:e=>{var t={};e.exports=function(e,r){var n=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},7825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var o=void 0!==r.layer;o&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,o&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var a=r.sourceMap;a&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},7935:(e,t,r)=>{e.exports=r.p+"images/46d63299c3420c030b4e.png"},7986:(e,t,r)=>{e.exports=r.p+"images/ac9d74f57639792774bc.png"},8341:(e,t,r)=>{e.exports=r.p+"images/0a77fc47d727eab6fd39.png"},8490:(e,t,r)=>{e.exports=r.p+"images/6a84ae91f5d985ddc9ee.png"},8956:(e,t,r)=>{e.exports=r.p+"images/dc3f97e7bbcd5ea1ded9.png"},9e3:(e,t,r)=>{e.exports=r.p+"images/d31d84c693f649766aee.png"},9221:(e,t,r)=>{e.exports=r.p+"images/2f1e1970c2c20cf3a8d5.png"},9334:(e,t,r)=>{e.exports=r.p+"images/296dfeac15e2377fc1dc.png"},9593:(e,t,r)=>{e.exports=r.p+"images/b27323cf850ed820855c.png"},9702:(e,t,r)=>{e.exports=r.p+"images/1d70f1dab2dd418c3612.png"},9745:(e,t,r)=>{e.exports=r.p+"images/546abb060a0837550fd1.png"}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={id:n,exports:{}};return e[n](a,a.exports,r),a.exports}r.m=e,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),r.b=document.baseURI||self.location.href,r.nc=void 0;var n=r(5072),o=r.n(n),a=r(7825),i=r.n(a),c=r(7659),l=r.n(c),s=r(5056),u=r.n(s),f=r(540),p=r.n(f),h=r(1113),d=r.n(h),y=r(1016),b={};function m(e,t){var r=Math.floor(e/t),n=e%t;return 0===r?0===n?"top-left":n===t-1?"top-right":"top":r===t-1?0===n?"bottom-left":n===t-1?"bottom-right":"bottom":0===n?"left":n===t-1?"right":"center"}function v(e){return e<15?"critical":e<50?"normal":"high"}function g(e){switch(e.type){case"swordsman":case"undead":return 1;case"bowman":case"vampire":return 2;case"magician":case"daemon":return 4;default:return 0}}function w(e){var t=e.type;switch(console.log("type",t),t){case"swordsman":case"undead":return 4;case"bowman":case"vampire":return 2;case"magician":case"daemon":return 1;default:return 0}}function S(e,t,r){var n=e%r,o=Math.floor(e/r),a=t%r,i=Math.floor(t/r);return Math.max(Math.abs(n-a),Math.abs(o-i))}function P(e,t,r,n){var o=e%r,a=Math.floor(e/r),i=t%r,c=Math.floor(t/r),l=i-o,s=c-a;if(0!==l&&0!==s&&Math.abs(l)!==Math.abs(s))return!1;for(var u,f=Math.max(Math.abs(l),Math.abs(s)),p=0===l?0:l/f,h=0===s?0:s/f,d=function(){var e=(a+h*y)*r+(o+p*y);if(n.some(function(t){return t.position===e}))return{v:!1}},y=1;y<f;y++)if(u=d())return u.v;return!0}function k(e){return["vampire","undead","daemon"].includes(e.type)}function O(e){return["bowman","swordsman","magician"].includes(e.type)}function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function j(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=x(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function x(e,t){if(e){if("string"==typeof e)return L(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?L(e,t):void 0}}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function E(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,T(n.key),n)}}function T(e){var t=function(e){if("object"!=C(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=C(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==C(t)?t:t+""}b.styleTagTransform=d(),b.setAttributes=u(),b.insert=l().bind(null,"head"),b.domAPI=i(),b.insertStyleElement=p(),o()(y.A,b),y.A&&y.A.locals&&y.A.locals;var R=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]},t=[{key:"bindToDOM",value:function(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}},{key:"drawUi",value:function(e){var t=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",function(e){return t.onNewGameClick(e)}),this.saveGameEl.addEventListener("click",function(e){return t.onSaveGameClick(e)}),this.loadGameEl.addEventListener("click",function(e){return t.onLoadGameClick(e)}),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(var r=0;r<Math.pow(this.boardSize,2);r+=1){var n=document.createElement("div");n.classList.add("cell","map-tile","map-tile-".concat(m(r,this.boardSize))),n.addEventListener("mouseenter",function(e){return t.onCellEnter(e)}),n.addEventListener("mouseleave",function(e){return t.onCellLeave(e)}),n.addEventListener("click",function(e){return t.onCellClick(e)}),this.boardEl.appendChild(n)}this.cells=Array.from(this.boardEl.children)}},{key:"redrawPositions",value:function(e){var t,r=j(this.cells);try{for(r.s();!(t=r.n()).done;)t.value.innerHTML=""}catch(e){r.e(e)}finally{r.f()}var n,o=j(e);try{for(o.s();!(n=o.n()).done;){var a=n.value,i=this.boardEl.children[a.position],c=document.createElement("div");c.classList.add("character",a.character.type);var l=document.createElement("div");l.classList.add("health-level");var s=document.createElement("div");s.classList.add("health-level-indicator","health-level-indicator-".concat(v(a.character.health))),s.style.width="".concat(a.character.health,"%"),l.appendChild(s),c.appendChild(l),i.appendChild(c)}}catch(e){o.e(e)}finally{o.f()}}},{key:"addCellEnterListener",value:function(e){this.cellEnterListeners.push(e)}},{key:"addCellLeaveListener",value:function(e){this.cellLeaveListeners.push(e)}},{key:"addCellClickListener",value:function(e){this.cellClickListeners.push(e)}},{key:"addNewGameListener",value:function(e){this.newGameListeners.push(e)}},{key:"addSaveGameListener",value:function(e){this.saveGameListeners.push(e)}},{key:"addLoadGameListener",value:function(e){this.loadGameListeners.push(e)}},{key:"onCellEnter",value:function(e){e.preventDefault();var t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach(function(e){return e.call(null,t)})}},{key:"onCellLeave",value:function(e){e.preventDefault();var t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach(function(e){return e.call(null,t)})}},{key:"onCellClick",value:function(e){var t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach(function(e){return e.call(null,t)})}},{key:"onNewGameClick",value:function(e){e.preventDefault(),this.newGameListeners.forEach(function(e){return e.call(null)})}},{key:"onSaveGameClick",value:function(e){e.preventDefault(),this.saveGameListeners.forEach(function(e){return e.call(null)})}},{key:"onLoadGameClick",value:function(e){e.preventDefault(),this.loadGameListeners.forEach(function(e){return e.call(null)})}},{key:"showError",value:function(e){alert(e)}},{key:"showMessage",value:function(e){alert(e)}},{key:"selectCell",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(e),this.cells[e].classList.add("selected","selected-".concat(t))}},{key:"deselectCell",value:function(e){var t,r=this.cells[e];(t=r.classList).remove.apply(t,function(e){return function(e){if(Array.isArray(e))return L(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||x(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Array.from(r.classList).filter(function(e){return e.startsWith("selected")})))}},{key:"showCellTooltip",value:function(e,t){this.cells[t].title=e}},{key:"hideCellTooltip",value:function(e){this.cells[e].title=""}},{key:"showDamage",value:function(e,t){var r=this;return new Promise(function(n){var o=r.cells[e],a=document.createElement("span");a.textContent=t,a.classList.add("damage"),o.appendChild(a),a.addEventListener("animationend",function(){o.removeChild(a),n()})})}},{key:"setCursor",value:function(e){this.boardEl.style.cursor=e}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}],t&&E(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function U(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,M(n.key),n)}}function M(e){var t=function(e){if("object"!=_(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==_(t)?t:t+""}var G=function(){return e=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(this instanceof e?this.constructor:void 0)===e)throw new Error("Character is abstract class");this.level=t,this.attack=0,this.defence=0,this.health=50,this.type=r;for(var n=1;n<t;n++)this.levelUp()},(t=[{key:"levelUp",value:function(){if(0===this.health)throw new Error("Нельзя повысить уровень мёртвого персонажа");this.level+=1;var e=(80+this.health)/100;this.attack=Math.max(this.attack,Math.floor(this.attack*e)),this.defence=Math.max(this.defence,Math.floor(this.defence*e)),this.health=Math.min(100,this.level+80)}}])&&U(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function A(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(A=function(){return!!e})()}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}function N(e,t){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},N(e,t)}var B=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=z(t),function(e,t){if(t&&("object"==$(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,A()?Reflect.construct(t,r||[],z(e).constructor):t.apply(e,r))}(this,t,[e,"bowman"])).attack=25,r.defence=25,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&N(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(G);function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function D(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(D=function(){return!!e})()}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},F(e)}function q(e,t){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},q(e,t)}var H=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=F(t),function(e,t){if(t&&("object"==I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,D()?Reflect.construct(t,r||[],F(e).constructor):t.apply(e,r))}(this,t,[e,"swordsman"])).attack=40,r.defence=10,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(G);function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function Q(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Q=function(){return!!e})()}function W(e){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},W(e)}function K(e,t){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},K(e,t)}var V=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=W(t),function(e,t){if(t&&("object"==J(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Q()?Reflect.construct(t,r||[],W(e).constructor):t.apply(e,r))}(this,t,[e,"magician"])).attack=10,r.defence=40,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(G);function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function Y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Y=function(){return!!e})()}function Z(e){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Z(e)}function ee(e,t){return ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ee(e,t)}var te=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=Z(t),function(e,t){if(t&&("object"==X(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Y()?Reflect.construct(t,r||[],Z(e).constructor):t.apply(e,r))}(this,t,[e,"vampire"])).attack=25,r.defence=25,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ee(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(G);function re(e){return re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},re(e)}function ne(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ne=function(){return!!e})()}function oe(e){return oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},oe(e)}function ae(e,t){return ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ae(e,t)}var ie=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=oe(t),function(e,t){if(t&&("object"==re(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ne()?Reflect.construct(t,r||[],oe(e).constructor):t.apply(e,r))}(this,t,[e,"undead"])).attack=40,r.defence=10,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ae(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(G);function ce(e){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(e)}function le(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(le=function(){return!!e})()}function se(e){return se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},se(e)}function ue(e,t){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ue(e,t)}var fe=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=se(t),function(e,t){if(t&&("object"==ce(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,le()?Reflect.construct(t,r||[],se(e).constructor):t.apply(e,r))}(this,t,[e,"daemon"])).attack=10,r.defence=40,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ue(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(G);function pe(e){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(e)}function he(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var l=n&&n.prototype instanceof c?n:c,s=Object.create(l.prototype);return de(s,"_invoke",function(r,n,o){var a,c,l,s=0,u=o||[],f=!1,p={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,r){return a=t,c=0,l=e,p.n=r,i}};function h(r,n){for(c=r,l=n,t=0;!f&&s&&!o&&t<u.length;t++){var o,a=u[t],h=p.p,d=a[2];r>3?(o=d===n)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=h&&((o=r<2&&h<a[1])?(c=0,p.v=n,p.n=a[1]):h<d&&(o=r<3||a[0]>n||n>d)&&(a[4]=r,a[5]=n,p.n=d,c=0))}if(o||r>1)return i;throw f=!0,n}return function(o,u,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===u&&h(u,d),c=u,l=d;(t=c<2?e:l)||!f;){a||(c?c<3?(c>1&&(p.n=-1),h(c,l)):p.n=l:p.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=p.n<0)?l:r.call(n,p))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:f}}}(r,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][n]?t(t([][n]())):(de(t={},n,function(){return this}),t),f=s.prototype=c.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,de(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=s,de(f,"constructor",s),de(s,"constructor",l),l.displayName="GeneratorFunction",de(s,o,"GeneratorFunction"),de(f),de(f,o,"Generator"),de(f,n,function(){return this}),de(f,"toString",function(){return"[object Generator]"}),(he=function(){return{w:a,m:p}})()}function de(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}de=function(e,t,r,n){if(t)o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{var a=function(t,r){de(e,t,function(e){return this._invoke(t,r,e)})};a("next",0),a("throw",1),a("return",2)}},de(e,t,r,n)}function ye(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=be(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function be(e,t){if(e){if("string"==typeof e)return me(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?me(e,t):void 0}}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ge(n.key),n)}}function ge(e){var t=function(e){if("object"!=pe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=pe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==pe(t)?t:t+""}var we=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.characters=function(e){return function(e){if(Array.isArray(e))return me(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||be(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t)},(t=[{key:"toArray",value:function(){return this.characters}},{key:Symbol.iterator,value:he().m(function e(){var t,r,n,o;return he().w(function(e){for(;;)switch(e.p=e.n){case 0:t=ye(this.characters),e.p=1,t.s();case 2:if((r=t.n()).done){e.n=4;break}return n=r.value,e.n=3,n;case 3:e.n=2;break;case 4:e.n=6;break;case 5:e.p=5,o=e.v,t.e(o);case 6:return e.p=6,t.f(),e.f(6);case 7:return e.a(2)}},e,this,[[1,5,6,7]])})}])&&ve(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function Se(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var l=n&&n.prototype instanceof c?n:c,s=Object.create(l.prototype);return Pe(s,"_invoke",function(r,n,o){var a,c,l,s=0,u=o||[],f=!1,p={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,r){return a=t,c=0,l=e,p.n=r,i}};function h(r,n){for(c=r,l=n,t=0;!f&&s&&!o&&t<u.length;t++){var o,a=u[t],h=p.p,d=a[2];r>3?(o=d===n)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=h&&((o=r<2&&h<a[1])?(c=0,p.v=n,p.n=a[1]):h<d&&(o=r<3||a[0]>n||n>d)&&(a[4]=r,a[5]=n,p.n=d,c=0))}if(o||r>1)return i;throw f=!0,n}return function(o,u,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===u&&h(u,d),c=u,l=d;(t=c<2?e:l)||!f;){a||(c?c<3?(c>1&&(p.n=-1),h(c,l)):p.n=l:p.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=p.n<0)?l:r.call(n,p))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:f}}}(r,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][n]?t(t([][n]())):(Pe(t={},n,function(){return this}),t),f=s.prototype=c.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,Pe(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=s,Pe(f,"constructor",s),Pe(s,"constructor",l),l.displayName="GeneratorFunction",Pe(s,o,"GeneratorFunction"),Pe(f),Pe(f,o,"Generator"),Pe(f,n,function(){return this}),Pe(f,"toString",function(){return"[object Generator]"}),(Se=function(){return{w:a,m:p}})()}function Pe(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Pe=function(e,t,r,n){if(t)o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{var a=function(t,r){Pe(e,t,function(e){return this._invoke(t,r,e)})};a("next",0),a("throw",1),a("return",2)}},Pe(e,t,r,n)}var ke=Se().m(Oe);function Oe(e,t){var r,n;return Se().w(function(o){for(;;)switch(o.n){case 0:return r=e[Math.floor(Math.random()*e.length)],n=Math.floor(Math.random()*t)+1,o.n=1,new r(n);case 1:o.n=0;break;case 2:return o.a(2)}},ke)}function Ce(e,t,r){for(var n=Oe(e,t),o=[],a=0;a<r;a++)o.push(n.next().value);return new we(o)}function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function xe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ee(n.key),n)}}function Le(e,t,r){return t&&xe(e.prototype,t),r&&xe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ee(e){var t=function(e){if("object"!=je(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=je(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==je(t)?t:t+""}var Te=Le(function e(t,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof G))throw new Error("character must be instance of Character or its children");if("number"!=typeof r)throw new Error("position must be a number");this.character=t,this.position=r});function Re(e){return Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Re(e)}function _e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ue(n.key),n)}}function Ue(e){var t=function(e){if("object"!=Re(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Re(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Re(t)?t:t+""}var Me,Ge={bowman:B,swordsman:H,magician:V,vampire:te,undead:ie,daemon:fe},$e=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentPlayerTurn=!0,this.selectedCharacter=null,this.positionedCharacters=[],this.currentLevel=1,this.scores=0,this.maxScores=0}return t=e,r=[{key:"from",value:function(t){var r,n;if(!t)return new e;var o=new e;return o.currentPlayerTurn=null===(r=t.currentPlayerTurn)||void 0===r||r,o.selectedCharacter=null!==(n=t.selectedCharacter)&&void 0!==n?n:null,o.currentLevel=t.currentLevel||1,o.scores=t.scores||0,o.maxScores=t.maxScores||0,Array.isArray(t.positionedCharacters)?o.positionedCharacters=t.positionedCharacters.map(function(e){var t=Ge[e.character.type];if(!t)return console.warn("Неизвестный тип персонажа: ".concat(e.character.type)),null;var r=new t(e.character.level);return r.health=e.character.health,r.attack=e.character.attack,r.defence=e.character.defence,new Te(r,e.position)}).filter(Boolean):o.positionedCharacters=[],o}}],null&&_e(t.prototype,null),r&&_e(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r}();function Ae(e){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ae(e)}function ze(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(Ae(e)+" is not iterable")}function Ne(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var l=n&&n.prototype instanceof c?n:c,s=Object.create(l.prototype);return Be(s,"_invoke",function(r,n,o){var a,c,l,s=0,u=o||[],f=!1,p={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,r){return a=t,c=0,l=e,p.n=r,i}};function h(r,n){for(c=r,l=n,t=0;!f&&s&&!o&&t<u.length;t++){var o,a=u[t],h=p.p,d=a[2];r>3?(o=d===n)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=h&&((o=r<2&&h<a[1])?(c=0,p.v=n,p.n=a[1]):h<d&&(o=r<3||a[0]>n||n>d)&&(a[4]=r,a[5]=n,p.n=d,c=0))}if(o||r>1)return i;throw f=!0,n}return function(o,u,d){if(s>1)throw TypeError("Generator is already running");for(f&&1===u&&h(u,d),c=u,l=d;(t=c<2?e:l)||!f;){a||(c?c<3?(c>1&&(p.n=-1),h(c,l)):p.n=l:p.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=p.n<0)?l:r.call(n,p))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:f}}}(r,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][n]?t(t([][n]())):(Be(t={},n,function(){return this}),t),f=s.prototype=c.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,Be(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=s,Be(f,"constructor",s),Be(s,"constructor",l),l.displayName="GeneratorFunction",Be(s,o,"GeneratorFunction"),Be(f),Be(f,o,"Generator"),Be(f,n,function(){return this}),Be(f,"toString",function(){return"[object Generator]"}),(Ne=function(){return{w:a,m:p}})()}function Be(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Be=function(e,t,r,n){if(t)o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{var a=function(t,r){Be(e,t,function(e){return this._invoke(t,r,e)})};a("next",0),a("throw",1),a("return",2)}},Be(e,t,r,n)}function Ie(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return De(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?De(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function De(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Fe(e,t,r,n,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,o)}function qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,He(n.key),n)}}function He(e){var t=function(e){if("object"!=Ae(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Ae(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ae(t)?t:t+""}var Je=function(){return e=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gamePlay=t,this.stateService=r,this.state=new $e,this.boardSize=8},t=[{key:"init",value:function(){var e;this.gamePlay.bindToDOM(document.querySelector("#game-container"));try{e=this.stateService.load(),console.log("Состояние загружено:",e)}catch(e){console.error("Ошибка загрузки:",e.message),this.gamePlay.showMessage("Не удалось загрузить игру. Запуск новой.")}this.state=$e.from(e),this.generateNewRoundIfNeeded(),this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addNewGameListener(this.onNewGameClick.bind(this));var t=this.getThemeByLevel(this.state.currentLevel);this.gamePlay.drawUi(t),this.gamePlay.redrawPositions(this.state.positionedCharacters)}},{key:"generateNewRoundIfNeeded",value:function(){this.state.positionedCharacters&&0!==this.state.positionedCharacters.length||this.generateNewRound()}},{key:"getThemeByLevel",value:function(e){return{1:"prairie",2:"desert",3:"arctic",4:"mountain"}[e]||"prairie"}},{key:"onCellClick",value:function(e){var t=this.state,r=t.currentPlayerTurn,n=t.selectedCharacter;if(r){if(null!==n){var o=this.state.positionedCharacters.find(function(e){return e.position===n}),a=this.state.positionedCharacters.find(function(t){return t.position===e});if(a&&!O(a.character)&&S(n,e,this.boardSize)<=g(o.character)&&P(n,e,this.boardSize,this.state.positionedCharacters)){var i=this.calculateDamage(o.character,a.character);return this.gamePlay.showDamage(e,i),a.character.health-=i,a.character.health<=0&&(this.state.positionedCharacters=this.state.positionedCharacters.filter(function(t){return t.position!==e}),this.stateService.save(this.state)),this.gamePlay.redrawPositions(this.state.positionedCharacters),this.gamePlay.deselectCell(n),this.state.selectedCharacter=null,this.aiTurn(),void this.checkGameOverAndNextLevel()}return!a&&this.canMoveTo(n,e)?(this.state.positionedCharacters.find(function(e){return e.position===n}).position=e,this.gamePlay.deselectCell(n),this.state.selectedCharacter=null,this.gamePlay.redrawPositions(this.state.positionedCharacters),this.aiTurn(),void this.checkGameOverAndNextLevel()):a&&O(a.character)?(this.gamePlay.deselectCell(n),this.state.selectedCharacter=e,void this.gamePlay.selectCell(e,"yellow")):(this.stateService.save(this.state),void this.gamePlay.showError("Невозможно выполнить действие"))}var c=this.state.positionedCharacters.find(function(t){return t.position===e});if(c&&O(c.character))return this.state.selectedCharacter=e,void this.gamePlay.selectCell(e,"yellow");this.gamePlay.showError("Здесь нет вашего персонажа")}else this.gamePlay.showError("Сейчас ход компьютера!")}},{key:"onCellEnter",value:function(e){var t,r,n,o=this,a=null===(t=this.state.positionedCharacters.find(function(t){return t.position===e}))||void 0===t?void 0:t.character;if(a){var i=function(e){var t={level:arguments.length<=1?void 0:arguments[1],attack:arguments.length<=2?void 0:arguments[2],defence:arguments.length<=3?void 0:arguments[3],health:arguments.length<=4?void 0:arguments[4]};return"🎖".concat(t.level," ⚔").concat(t.attack," 🛡").concat(t.defence," ❤").concat(t.health)}(Me||(r=["\n        level: ",",\n        attack: ",",\n        defence: ",",\n        health: ","\n      "],n||(n=r.slice(0)),Me=Object.freeze(Object.defineProperties(r,{raw:{value:Object.freeze(n)}}))),a.level,a.attack,a.defence,a.health);this.gamePlay.showCellTooltip(i,e)}if(this.state.currentPlayerTurn){if(null===this.state.selectedCharacter){var c=this.state.positionedCharacters.find(function(t){return t.position===e});return c&&c.character instanceof G?void this.gamePlay.setCursor("pointer"):void this.gamePlay.setCursor("notallowed")}var l=this.state.positionedCharacters.find(function(e){return e.position===o.state.selectedCharacter}),s=this.state.positionedCharacters.find(function(t){return t.position===e});if(s&&s.character instanceof G)try{s.character instanceof G&&s.character.type!==l.character.type?S(l.position,e,this.boardSize)<=g(l.character)&&P(l.position,e,this.boardSize,this.state.positionedCharacters)?(this.gamePlay.selectCell(e,"red"),this.gamePlay.setCursor("crosshair")):this.gamePlay.setCursor("notallowed"):this.gamePlay.setCursor("pointer")}catch(r){console.log(r)}else{console.log("character",l.character);var u=w(l.character);S(l.position,e,this.boardSize)<=u&&P(l.position,e,this.boardSize,this.state.positionedCharacters)?(this.gamePlay.selectCell(e,"green"),this.gamePlay.setCursor("pointer")):this.gamePlay.setCursor("notallowed")}}else this.gamePlay.setCursor("notallowed")}},{key:"onCellLeave",value:function(e){null!==this.state.selectedCharacter&&this.state.selectedCharacter===e||this.gamePlay.deselectCell(e),this.gamePlay.setCursor("auto")}},{key:"canMoveTo",value:function(e,t){var r=w(this.state.positionedCharacters.find(function(t){return t.position===e}).character);return S(e,t,this.boardSize)<=r&&!this.state.positionedCharacters.some(function(e){return e.position===t})}},{key:"calculateDamage",value:function(e,t){var r=Math.max(e.attack-t.defence,Math.floor(.1*e.attack));return Math.floor(r)}},{key:"aiTurn",value:(r=Ne().m(function e(){var t,r,n,o,a,i,c,l,s,u,f,p=this;return Ne().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,new Promise(function(e){return setTimeout(e,500)});case 1:t=this.state.positionedCharacters.filter(function(e){return k(e.character)}),r=this.state.positionedCharacters.filter(function(e){return O(e.character)}),n=Ie(t),e.p=2,n.s();case 3:if((o=n.n()).done){e.n=12;break}a=o.value,i=Ie(r),e.p=4,l=Ne().m(function e(){var t,r,n,o;return Ne().w(function(e){for(;;)switch(e.n){case 0:if(t=c.value,r=S(a.position,t.position,p.boardSize),n=g(a.character),!(r<=n&&P(a.position,t.position,p.boardSize,p.state.positionedCharacters))){e.n=2;break}return o=p.calculateDamage(a.character,t.character),e.n=1,p.gamePlay.showDamage(t.position,o);case 1:return t.character.health-=o,t.character.health<=0&&(p.state.positionedCharacters=p.state.positionedCharacters.filter(function(e){return e.position!==t.position})),p.gamePlay.redrawPositions(p.state.positionedCharacters),p.state.currentPlayerTurn=!0,e.a(2,{v:void 0});case 2:return e.a(2)}},e)}),i.s();case 5:if((c=i.n()).done){e.n=8;break}return e.d(ze(l()),6);case 6:if(!(s=e.v)){e.n=7;break}return e.a(2,s.v);case 7:e.n=5;break;case 8:e.n=10;break;case 9:e.p=9,u=e.v,i.e(u);case 10:return e.p=10,i.f(),e.f(10);case 11:e.n=3;break;case 12:e.n=14;break;case 13:e.p=13,f=e.v,n.e(f);case 14:return e.p=14,n.f(),e.f(14);case 15:this.state.currentPlayerTurn=!0,this.stateService.save(this.state);case 16:return e.a(2)}},e,this,[[4,9,10,11],[2,13,14,15]])}),n=function(){var e=this,t=arguments;return new Promise(function(n,o){var a=r.apply(e,t);function i(e){Fe(a,n,o,i,c,"next",e)}function c(e){Fe(a,n,o,i,c,"throw",e)}i(void 0)})},function(){return n.apply(this,arguments)})},{key:"checkGameOverAndNextLevel",value:function(){var e=this.state.positionedCharacters.some(function(e){return k(e.character)}),t=this.state.positionedCharacters.some(function(e){return O(e.character)});if(!t)return this.lockBoard(),this.gamePlay.showMessage("Вы проиграли!"),void this.updateMaxScores();if(!e){if(this.state.currentLevel>=4)return this.lockBoard(),this.gamePlay.showMessage("Поздравляем! Вы прошли игру!"),void this.updateMaxScores();this.state.currentLevel+=1,this.state.scores+=50;var r,n=Ie(this.state.positionedCharacters);try{for(n.s();!(r=n.n()).done;){var o=r.value;O(o.character)&&o.character.levelUp()}}catch(e){n.e(e)}finally{n.f()}this.generateNewRound();var a=this.getThemeByLevel(this.state.currentLevel);this.gamePlay.drawUi(a),this.gamePlay.redrawPositions(this.state.positionedCharacters)}}},{key:"lockBoard",value:function(){this.gamePlay.boardEl.style.pointerEvents="none",this.gamePlay.setCursor("not-allowed")}},{key:"unlockBoard",value:function(){this.gamePlay.boardEl.style.pointerEvents="auto"}},{key:"onNewGameClick",value:function(){this.updateMaxScores(),this.state=new $e,this.state.maxScores=this.state.scores,this.unlockBoard(),this.generateNewRound(),this.stateService.save(this.state),this.gamePlay.drawUi(this.getThemeByLevel(this.state.currentLevel)),this.gamePlay.redrawPositions(this.state.positionedCharacters),this.stateService.save(this.state)}},{key:"updateMaxScores",value:function(){this.state.scores>this.state.maxScores&&(this.state.maxScores=this.state.scores),this.stateService.save(this.state)}},{key:"generateNewRound",value:function(){var e=this.state.currentLevel,t=Ce([B,H,V],e,4),r=Ce([te,ie,fe],e,4),n=Array.isArray(t)?t:t.toArray(),o=Array.isArray(r)?r:r.toArray();this.state.positionedCharacters=[];for(var a=0;a<n.length;a++)this.state.positionedCharacters.push(new Te(n[a],[0,1,8,9][a]));for(var i=0;i<o.length;i++)this.state.positionedCharacters.push(new Te(o[i],[54,55,62,63][i]))}}],t&&qe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,n}();function Qe(e){return Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qe(e)}function We(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ke(n.key),n)}}function Ke(e){var t=function(e){if("object"!=Qe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Qe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Qe(t)?t:t+""}var Ve=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storage=t},t=[{key:"save",value:function(e){try{this.storage.setItem("state",JSON.stringify(e))}catch(e){throw new Error("Failed to save game: ".concat(e.message))}}},{key:"load",value:function(){try{var e=this.storage.getItem("state");if(!e)throw new Error("No saved game found");return JSON.parse(e)}catch(e){throw new Error("Failed to load game: ".concat(e.message))}}}],t&&We(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),Xe=new R;Xe.bindToDOM(document.querySelector("#game-container")),new Je(Xe,new Ve(localStorage)).init()})();